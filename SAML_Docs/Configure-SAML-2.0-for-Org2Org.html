<html>
<head>
    <link href="../resources/css/doc-style.css" media="all" rel="stylesheet" type="text/css" />
    <script src="../resources/js/jff5neq.js" type="text/javascript"></script>
    <script type="text/javascript">
        try{Typekit.load();}catch(e){}
    </script>
    <script src="../resources/js/jquery.min.js"></script>
    <script src="../resources/js/vkbeautify.js"></script>

    <title>Setup SSO</title>

    <script src="../resources/js/getAppValues.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<div class="header clearfix">
    <div class="logo-container">
        <img src="../resources/img/okta-logo-white.png" alt="Okta" />
    </div>
</div>
<div class="okta-instructions">
<h1>How to Configure SAML 2.0 for Okta Org2Org Application</h1>
    <div id="loginAdminApp" class="okta-callout okta-error" style="display: none;">
        <span class="icon-24 icon-error"></span>
        <p>This setup might fail without parameter values that are customized for your organization. Please use the Okta Administrator Dashboard to add an application and view the values that are specific for your organization.</strong></p>
    </div>
    
    <h2>Overview</h2>
    <p>The Org2Org connector application is used to push/match users from one Okta organization to another. By configuring SAML for this application, users will be authenticated via SAML from one Okta organization to another. This application is used to master in the target (Hub) Okta organization, from the source (Spoke) Okta organization. The Org2Org application was specifically designed for a Hub/Spoke configuration. </p>
<hr>
    <h2>Assumptions</h2>
    This setup assumes that you are adding this Org2Org SAML Application to your <strong>Okta source (Spoke) organization.</strong>
    <hr>
<h2> Configuring the Hub/Target Org (Inbound SAML)</h2>
    <ol>
        <li>
            <p>Log into your Okta target organization (Hub) and select the <strong>Admin</strong> button.</p></li>
<li><p>Navigate to <strong>Security > Identity Providers</strong>, then click <strong>Add Identity Provider</strong> to create a new inbound SAML endpoint for the spoke/source affiliate.</p>
<p><strong>Note</strong>: All inbound SAML configurations will be created using the spoke/source affiliates name.</p>         
<p><img src="images/apps/org2orgnew1.png" alt="org2orgnew1.png" /></p>

</li>

<li><p>Under <strong>General Settings</strong>:</p>
<ul>
<li><p><strong>Name</strong>: Enter the spoke/source name.</p></li>
</ul>
</li>


<li><p>Under <strong>Authentication Settings</strong>:</p>
<ul>
<li><p><strong>Transform Username</strong>: Select from the drop down menu. This field specifies how to construct the subject's username from the SAML assertion using an Okta Expression Language transform of attributes defined in the IdP User Profile.</p></li>
<li><p><strong>Filter Username</strong>: Optional regular expression pattern used to filter transformed usernames to prevent the IdP from authenticating unintended or privileged users.</p></li>

<li><p><strong>Authenticate if username matches</strong>: Make desired selection from drop down. This field specifies what attribute(s) of existing users in Okta are compared to the transformed username to determine whether the authentication response is for a new or existing user. Choose the user attribute to match against the transformed username.</p></li>

<li><p><strong>If no match is found</strong>: Make desired selection. If <strong>Create new user (JIT)</strong> is selected, a user's profile will be created in the target org if the user does not exist in the target org. This field specifies the action for authentication responses that do not match an existing user in the Okta organization.</p></li>

</ul>
</li>

<li><p>Under <strong>JIT Settings</strong>:</p>
<ul>
<li><p><strong>Profile Master</strong>: Make desired selection. This field determines if the IdP should act as a source of truth for user profile attributes. The IdP must be prioritized with other Profile Masters if the user is assigned to additional apps or directories that are also Profile Masters. See Profile Mastering documentation for more information.</p></li>
<li><p><strong>Group Assignments</strong>: Make desired selection. This field specifies the behavior of group assignments during provisioning.</p></li>
</ul>
</li>


<li><p>Under <strong>SAML Protocol Settings</strong>:</p>
<ul>
<li><p><strong>IdP Issuer URI</strong>: Copy and paste the following:</p>
<p><kbd id="issuer">Sign into the Okta admin app to have this variable generated for you.</kbd></p>
</li>
<li><p><strong>IdP Single Sign On URL</strong>: Copy and paste the following:</p>
<p><kbd id="signOnUrl">Sign in to the Okta Admin app to generate this variable.</kbd></p>

</li>
<li><p><strong>IdP Signature Certificate</strong>: Download, then upload the X509 Certificate (below):</p>
<p><kbd id="downloadCertificate">Sign into the Okta admin app to have this variable generated for you.</kbd></p>
</li>

</ul>
</li>
<li><p>Click <strong>Add Identity Provider/Save</strong>.</p></li>



<li><p>Once you save, you are returned to the main Identity Providers page.</p>
<ul>
<li><p>Locate the Identity provider you just added. Copy the value for <strong>Assertion Consumer Service</strong> and paste it in the <strong>Hub ACS URL</strong> field in your source (spoke) Org2Org Application setup under the <strong>Sign On</strong> tab.</p></li>
<li><p>Copy the value for <strong>Audience URI</strong> and paste it in the <strong>Audience URI</strong> field in your spoke (source) Org2Org Application setup under the <strong>Sign On</strong> tab:</p></li>
<li><p>Click <strong>Save</strong>.</p></li>

</ul>
<p><img src="images/apps/org2orgnew2.png" alt="org2orgnew2.png" /></p>

</li>

        <li>Done!</li>
        </ol>
<hr>

        <h2>Configuring Application for Hub/Spoke</h2>
        <p>The following instructions enable users in the Spoke org(s) to login to an application that's managed and provisioned by a single Hub org.</p>
        <ol><li>Follow standard Okta configuration methods for setting the application up in Hub.</li>
        <li>Once configured, locate the App Embedded link under the General Tab of the application. This will become the Default Relay State of the Spoke bookmark application. </li>
        </ol>

<h3>Example</h3>
        <p>The following example will walk you through the exact steps to perform, using Google Apps as an example.</p>
        

        <p><strong>Note</strong>: Test to ensure the application works correctly in the Hub before configuring the Spoke.</p>
        <ol>
        <li>
            <p>In the Hub org, configure the application that you want to share in spoke org. For this example, we used Google Apps with SAML sign on mode.</p>
            <p><img src="images/apps/org2org4.png" alt="org2org4.png" width="300" height="300" /></p>
        </li>
        <li>
            <p>Log into your source Okta org (spoke), and go to the Admin console. Click on <strong>Add Application</strong>, then add <strong>Bookmark App</strong>.</p>
        </li>
        <li>
            <p>Type in an <strong>Application label</strong> (Hint: Name of the application you are creating - Google Apps in case of our example).</p>
        </li>
        <li>
            <p>You will need 3 things to construct the URL, as follows:</p>
            <ol>
                <li><p>Copy and paste the <strong>IdP Single Sign On URL</strong> to the <strong>URL</strong> field, from Step 6 above, in the <strong>Configuring the Hub/Target Org (Inbound SAML)</strong>.</p></li>


                </li>
                <li>
                    <p>Add <strong>?RelayState=</strong></p>
                </li>
                <li>
                    <p> Followed by the <strong>Embedded link</strong> of the application in the hub. The <strong>Embedded link</strong> can be found under the <strong>General</strong> tab for Google Apps, or any other application you are configuring.</p>
                </li>
            <p>For Example:</p>
            <kbd>http://sourceorg.okta.com/app/okta_org2org/exkidkmZXAoxbgwz20g3/sso/saml?RelayState=http://huborg.okta.com/home/google/0oaiqwYT8RpdS8I6D0g3/26</kbd>
            <p><img src="images/apps/org2org3.png" alt="org2org3.png" width="500" height="330" /></p>
            </ol>
        <li>
            <p>Done!</p>
<p>Now users can seamlessly log in to Google Apps from spoke org; Google Apps is configured in hub org.</p>
        </li>
        </li>
        </ol>
    
</div>
</body>
</html>
